name: Deploy

on:
  push:
    branches: [ "main" ]
    paths: [ "frontend/**", "backend/**" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    defaults:
      run:
        working-directory: backend

    strategy:
      matrix:
        node-version: [18.x]

    steps:
    - name: Build project
      uses: ./.github/workflows/ci.yml
    - name: Deploy to server
      uses: actions/ftp-deploy@v3.1.2
      with:
        server: 217.170.197.88
        port: ${{secrets.SERVER_PORT}}
        username: ${{secrets.SERVER_USERNAME}}
        password: ${{secrets.SERVER_PASSWORD}}
        server-dir: var/www/eksempler.no/solvann/test/
        dry-run: true
